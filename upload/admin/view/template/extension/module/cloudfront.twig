{{ header }}{{ column_left }}
<div id="content">
  <div class="page-header">
    <div class="container-fluid">
      <div class="pull-right">
        <button type="submit" form="form-cloudfront" data-toggle="tooltip" title="{{ button_save }}" class="btn btn-primary"><i class="fa fa-save"></i></button>
        <a href="{{ cancel }}" data-toggle="tooltip" title="{{ button_cancel }}" class="btn btn-default"><i class="fa fa-reply"></i></a></div>
      <h1>{{ heading_title }}</h1>
      <ul class="breadcrumb">
        {% for breadcrumb in breadcrumbs %}
        <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
        {% endfor %}
      </ul>
    </div>
  </div>
  <div class="container-fluid">
    <div id="build-notification"></div>
    {% if success %}
    <div class="alert alert-success"><i class="fa fa-check-circle"></i> {{ success }}
      <button type="button" class="close" data-dismiss="alert">&times;</button>
    </div>
    {% endif %}
    {% if error_warning %}
    <div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> {{ error_warning }}
      <button type="button" class="close" data-dismiss="alert">&times;</button>
    </div>
    {% endif %}
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title"><i class="fa fa-pencil"></i> {{ text_edit }}</h3>
      </div>
      <div class="panel-body">
        <form action="{{ action }}" method="post" enctype="multipart/form-data" id="form-cloudfront" class="form-horizontal">
          <ul class="nav nav-tabs">
            <li class="active"><a href="#tab-general" data-toggle="tab">{{ tab_general }}</a></li>
            {{ about }}
          </ul>
          <div class="tab-content">
		    <div class="tab-pane active" id="tab-general">
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-cloudfront-access-key">{{ entry_access_key }}</label>
                <div class="col-sm-10">
                  <input type="text" name="cloudfront_access_key" value="{{ cloudfront_access_key }}" placeholder="{{ entry_access_key }}" id="input-cloudfront-access-key" class="form-control" />
                  {% if error_access_key %}
                  <div class="text-danger">{{ error_access_key }}</div>
                  {% endif %}
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-cloudfront-secret-key">{{ entry_secret_key }}</label>
                <div class="col-sm-10">
                  <input type="text" name="cloudfront_secret_key" value="{{ cloudfront_secret_key }}" placeholder="{{ entry_secret_key }}" id="input-cloudfront-secret-key" class="form-control" />
                  {% if error_secret_key %}
                  <div class="text-danger">{{ error_secret_key }}</div>
                  {% endif %}
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-cloudfront-image-bucket">{{ entry_image_bucket }}</label>
                <div class="col-sm-10">
                  <input type="text" name="cloudfront_image_bucket" value="{{ cloudfront_image_bucket }}" placeholder="{{ entry_image_bucket }}" id="input-cloudfront-image-bucket" class="form-control" />
                  {% if error_image_bucket %}
                    <div class="text-danger">{{ error_image_bucket }}</div>
                  {% endif %}
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="select-cloudfront-image-location">{{ entry_image_location }}</label>
                <div class="col-sm-10">
                  <select name="cloudfront_image_location" class="form-control">
                    {% for server_location in server_locations %}
                      {% if server_location == cloudfront_image_location %}
                      <option value="{{ server_location }}" selected="selected">{{ server_location }}</option>
                      {% else %}
                      <option value="{{ server_location }}">{{ server_location }}</option>
                      {% endif %}
                    {% endfor %}
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-cloudfront-download-bucket">{{ entry_download_bucket }}</label>
                <div class="col-sm-10">
                  <input type="text" name="cloudfront_download_bucket" value="{{ cloudfront_download_bucket }}" placeholder="{{ entry_download_bucket }}" id="input-cloudfront-download-bucket" class="form-control" />
                  {% if error_download_bucket %}
                    <div class="text-danger">{{ error_download_bucket }}</div>
                  {% endif %}
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="select-cloudfront-download-location">{{ entry_download_location }}</label>
                <div class="col-sm-10">
                  <select name="cloudfront_download_location" class="form-control">
                    {% for server_location in server_locations %}
                      {% if server_location == cloudfront_download_location %}
                      <option value="{{ server_location }}" selected="selected">{{ server_location }}</option>
                      {% else %}
                      <option value="{{ server_location }}">{{ server_location }}</option>
                      {% endif %}
                    {% endfor %}
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-cloudfront-distribution-id">{{ entry_distribution_id }}</label>
                <div class="col-sm-10">
                  <input type="text" name="cloudfront_distribution_id" value="{{ cloudfront_distribution_id }}" placeholder="{{ entry_distribution_id }}" id="input-cloudfront-distribution-id" class="form-control" />
                  {% if error_distribution_id %}
                  <div class="text-danger">{{ error_distribution_id }}</div>
                  {% endif %}
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-cloudfront-url">{{ entry_url }}</label>
                <div class="col-sm-10">
                  <input type="text" name="cloudfront_url" value="{{ cloudfront_url }}" placeholder="{{ entry_url }}" id="input-cloudfront-url" class="form-control" />
                  {% if error_url %}
                  <div class="text-danger">{{ error_url }}</div>
                  {% endif %}
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-cloudfront-usage">{{ entry_usage }}</label>
                <div class="col-sm-10">
                  <select name="cloudfront_usage" class="form-control">
                    <option value="1"{{ cloudfront_usage == '1' ? ' selected="selected"' }}>Admin</option>
                    <option value="2"{{ cloudfront_usage == '2' ? ' selected="selected"' }}>Shop Front</option>
                    <option value="3"{{ cloudfront_usage == '3' ? ' selected="selected"' }}>Both</option>
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-cloudfront-status">{{ entry_status }}</label>
                <div class="col-sm-10">
                  <select name="cloudfront_status" id="input-cloudfront-status" class="form-control">
                    {% if cloudfront_status %}
                    <option value="1" selected="selected">{{ text_enabled }}</option>
                    <option value="0">{{ text_disabled }}</option>
                    {% else %}
                    <option value="1">{{ text_enabled }}</option>
                    <option value="0" selected="selected">{{ text_disabled }}</option>
                    {% endif %}
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-build-cache">{{ entry_build_cache }}</label>
                <div class="col-sm-10">
                  <button type="button" id="button-build" class="btn btn-success">{{ button_build_cache }}</a>
                </div>
              </div>
		      <div class="form-group">
                <label class="col-sm-2 control-label" for="input-clear-cache">{{ entry_clear_cache }}</label>
                <div class="col-sm-10">
                  <a href="{{ clear_cache }}" class="btn btn-danger">{{ button_clear_cache }}</a>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-export-download">{{ entry_export_download }}</label>
                <div class="col-sm-10">
                  <a href="{{ export_download }}" class="btn btn-info">{{ button_export_download }}</a>
                </div>
              </div>
            </div>
            {{ tab }}
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript"><!--
$(document).ready(function() {
	$('#button-build').click(function() {
    alert('{{ build_cache }}');
		build('{{ build_cache }}');
	});
});
  
function build(url) { 

	$.ajax({
		url: url,
		type: 'get',	
		dataType: 'json',
		beforeSend: function() {
			$('#button-build').prop('disabled', true);
			$('#button-build').before('<i class="wait fa fa-spinner"></i>');
		},			
		success: function(json) {
			$('.wait').remove();
            
			$('#build-notification').html();		
			
			if (json['next']) {
				if (json['success']) {
					$('#build-notification').html('<div class="alert alert-success">' + json['success'] + '</div>');
					
					build(json['next']);
				}		
			} else {
				if (json['success']) {
					$('#build-notification').html('<div class="alert alert-success" style="display: none;">' + json['success'] + '</div>');
			
					$('.alert-success').fadeIn('slow');
                    
                    $('#button-build').prop('disabled', false);
				}					
			}				
		}
	});
}
//--></script>
{{ footer }}